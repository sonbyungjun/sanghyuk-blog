---
slug: pr-automation-tool
title: PR 자동화 도구 만들기 - gh CLI와 쉘 스크립트 실전
description: 귀찮은 PR 생성 과정을 자동화한 이야기. gh CLI, 리뷰어 선택, Discord 알림까지.
createdAt: "2025/01/22"
updatedAt: ""
tags: ["PR", "GitHub", "자동화", "gh CLI", "쉘스크립트", "협업"]
featured: true
thumbnail: ./thumbnail.png
---

PR 올릴 때마다 하는 일이 있다.

1. 브랜치 push
2. GitHub 웹사이트 열기
3. PR 생성 버튼 클릭
4. 제목 입력 (Task ID 포맷 맞추기)
5. 리뷰어 선택
6. 디스코드에 "리뷰 부탁드립니다" 메시지

이걸 하루에 3~4번 반복하니까 자동화하고 싶어졌다.

## 왜 만들었나

### 반복이 귀찮다

PR 제목은 항상 `[TASK-123] 기능 추가` 포맷이다. 매번 Task ID 복사하고 대괄호 치는 게 귀찮다.

### 리뷰어 선택이 번거롭다

GitHub 웹에서 리뷰어 드롭다운 열고, 이름 검색하고, 클릭하고... 터미널에서 한 번에 끝내고 싶다.

### 알림을 깜빡한다

PR 올려놓고 디스코드 알림 안 보내서 리뷰가 늦어진 적이 많다. 자동으로 보내면 좋겠다.

## 만든 것: auto-pr-relay

터미널에서 PR 생성 → 리뷰어 선택 → Discord 알림까지 한 번에.

```bash
$ ./run-github-pr.sh

Task ID를 입력해주세요:
TASK-456

PR 제목을 입력해주세요:
결제 재시도 로직 추가

===== 리뷰어 선택 =====
리뷰어를 선택해주세요:
0) 기본 리뷰어 사용
1) 박현준 (ReturnToFirst)
2) 이하민 (hmmhmmhm)
3) 문대승 (Moon-DaeSeung)

리뷰어 번호를 입력하세요: 3

[INFO] PR 생성 완료: https://github.com/...
[INFO] Discord 알림 전송 완료
```

## 핵심 코드 분석

### 1. PR 제목 자동 포맷팅

매번 `[TASK-123]` 형식 맞추는 게 귀찮았다.

```bash
# Task ID와 제목을 따로 입력받아서 포맷팅
echo "Task ID를 입력해주세요:"
read -r TASK_ID

echo "PR 제목을 입력해주세요:"
read -r PR_TITLE

# 자동 포맷팅
FORMATTED_TITLE="[${TASK_ID}] ${PR_TITLE}"
```

이제 `TASK-456`과 `결제 재시도 로직 추가`만 입력하면 `[TASK-456] 결제 재시도 로직 추가`가 된다.

### 2. gh CLI로 PR 생성

GitHub CLI(`gh`)가 핵심이다. 웹 브라우저 없이 터미널에서 PR을 만든다.

```bash
# PR이 이미 있는지 확인
PR_URL=$(gh pr list --head "$CURRENT_BRANCH" --json url -q '.[0].url')

if [[ -n "$PR_URL" ]]; then
    # 이미 있으면 업데이트
    gh pr edit $PR_NUMBER --title "$FORMATTED_TITLE"
else
    # 없으면 새로 생성
    gh pr create \
        --base $BASE_BRANCH \
        --head $CURRENT_BRANCH \
        --title "$FORMATTED_TITLE" \
        --body ""
fi
```

`gh pr create` 한 줄이면 PR이 생긴다.

### 3. 리뷰어 선택 메뉴

팀원 목록을 JSON으로 관리하고, 메뉴로 선택한다.

```json
// members.json
[
  {
    "login": "Moon-DaeSeung",
    "name": "문대승",
    "discord": "<@554304408050204692>"
  },
  // ...
]
```

```bash
# 리뷰어 목록을 메뉴로 출력
echo "===== 리뷰어 선택 =====" >&2
echo "0) 기본 리뷰어 사용" >&2

for ((i=0; i<${#reviewer_names[@]}; i++)); do
    echo "$((i+1))) ${reviewer_names[$i]} (${reviewers[$i]})" >&2
done

read -r choice
```

숫자만 입력하면 리뷰어가 지정된다. 0번을 누르면 프로젝트별 기본 리뷰어가 자동 선택.

### 4. Discord 알림

PR 생성하면 자동으로 리뷰어에게 알림.

```bash
# Discord Webhook URL
WEBHOOK_URL="https://discord.com/api/webhooks/..."

# PR URL 생성 (SSH URL을 HTTPS로 변환)
REPO_URL=$(git config --get remote.origin.url)
PR_URL=$(echo $REPO_URL | sed 's/git@github.com:/https:\/\/github.com\//')
PR_URL="${PR_URL%.git}/pull/$PR_NUMBER"

# 메시지 전송
MESSAGE="{\"content\":\"## $PR_TITLE\n$PR_URL\n\n작성자: $ASSIGNER_NAME\n\n$DISCORD_ID\"}"
curl -H "Content-Type: application/json" -X POST -d "$MESSAGE" "$WEBHOOK_URL"
```

리뷰어의 Discord ID를 멘션해서 알림이 간다.

### 5. Git 작업 자동화

PR 전에 필요한 git 작업도 자동으로.

```bash
# 커밋되지 않은 변경사항 체크
if [[ -n $(git status -s) ]]; then
    echo "[ERROR] 커밋되지 않은 변경사항이 있습니다"
    exit 1
fi

# base 브랜치 최신화
git fetch origin $BASE_BRANCH
git rebase origin/$BASE_BRANCH

# force push
git push -f origin $CURRENT_BRANCH
```

develop/main 브랜치와 싱크 맞추고, 리베이스하고, push까지 알아서 해준다.

## 파일 구조

```
auto-pr-relay/
├── run-github-pr.sh          # 진입점 (토큰 관리)
├── create-pr-interactive.sh  # 메인 로직
├── reviewer-selection.sh     # 리뷰어 선택
├── notify-pr-reviewer.sh     # Discord 알림
├── git-utils.sh              # Git 유틸리티
├── pr-utils.sh               # PR 유틸리티
├── members.json              # 팀원 목록
└── default-reviewer.json     # 프로젝트별 기본 리뷰어
```

## gh CLI 핵심 명령어

이 도구의 핵심은 `gh` CLI다. 자주 쓰는 명령어들:

```bash
# PR 생성
gh pr create --base develop --head feature/xxx --title "제목"

# PR 목록 조회
gh pr list --head feature/xxx --json url

# PR 수정 (제목, 리뷰어)
gh pr edit 123 --title "새 제목" --add-reviewer username

# PR 상세 조회
gh pr view --json number,reviewRequests

# 현재 사용자 정보
gh api user --jq .login
```

GitHub 웹에서 하던 거의 모든 걸 터미널에서 할 수 있다.

## 설정 방법

### 1. gh CLI 설치

```bash
# macOS
brew install gh

# 로그인
gh auth login
```

### 2. 토큰 저장

처음 실행하면 GitHub 토큰을 물어본다. `.env.pr.local`에 저장해두면 다음부터 안 물어봄.

```
PR-TOKEN=ghp_xxxxxxxxxxxx
```

### 3. 팀원 정보 설정

`members.json`에 팀원 GitHub ID와 Discord ID를 넣어둔다.

### 4. 실행

```bash
./run-github-pr.sh
```

## 배운 것들

### JSON 파싱은 jq보다 bash로

`jq` 설치 의존성을 없애려고 bash로 JSON 파싱했다.

```bash
# bash regex로 JSON 값 추출
if [[ $line =~ \"login\":\ *\"([^\"]+)\" ]]; then
    login="${BASH_REMATCH[1]}"
fi
```

정교하진 않지만 단순한 구조엔 충분하다.

### stderr vs stdout 구분

메뉴 출력은 `>&2`로 stderr에, 실제 결과값만 stdout에 출력해야 파이프가 꼬이지 않는다.

```bash
echo "리뷰어를 선택해주세요:" >&2  # 화면에만 표시
echo "$REVIEWER"                    # 실제 리턴값
```

### 방어적 코딩

PR 없이 실행하거나, 커밋 없이 실행하거나 하는 예외 상황을 다 잡아야 했다.

```bash
# 브랜치 간 커밋 차이가 없으면 중단
DIFF_COUNT=$(git rev-list --count $BASE_BRANCH..$CURRENT_BRANCH)
if [ "$DIFF_COUNT" -eq 0 ]; then
    echo "[ERROR] 커밋 차이가 없습니다"
    exit 1
fi
```

## 결과

PR 하나 올리는 데 걸리는 시간:

- 이전: 2~3분 (브라우저 열고, 클릭하고, 입력하고...)
- 이후: 30초 (터미널에서 3개 입력)

하루에 4번 PR 올린다고 치면 매일 10분 절약. 한 달이면 3시간.

시간 절약도 좋지만, **컨텍스트 스위칭이 없어진 게 더 크다**. 터미널 떠나지 않고 PR까지 끝낼 수 있다.

## 마무리

귀찮은 건 자동화하자.

gh CLI가 생각보다 강력하다. GitHub 웹에서 하던 거의 모든 걸 터미널에서 할 수 있다.

쉘 스크립트는 지저분해 보여도 이런 자동화엔 딱이다. 빠르게 만들고 바로 쓸 수 있다.

다음엔 PR 템플릿 자동 생성이나, Jira 연동도 해볼 생각이다.
