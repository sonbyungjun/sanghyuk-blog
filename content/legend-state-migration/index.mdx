---
slug: legend-state-migration
title: "Legend Stateë¡œ ìƒíƒœê´€ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜ - React Hydration ì§€ì˜¥ íƒˆì¶œê¸°"
description: "ê¸°ì¡´ ìƒíƒœê´€ë¦¬ì—ì„œ Legend Stateë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ ê²ªì€ hydration mismatch ì—ëŸ¬ì™€ í•´ê²° ê³¼ì •"
createdAt: "2025/09/12"
updatedAt: ""
tags: ["React", "Legend State", "ìƒíƒœê´€ë¦¬", "Hydration", "Next.js"]
featured: false
thumbnail: ./thumbnail.png
---

## í”„ë¡œì íŠ¸ ê°œìš”

**í”„ë¡œì íŠ¸**: LRM (Legend State ê¸°ë°˜ ì›¹ì•±)  
**ê°œë°œ ê¸°ê°„**: 2025.09 (ì•½ 1ì£¼)  
**ê¸°ìˆ  ìŠ¤íƒ**: Next.js, TypeScript, Legend State, Tailwind CSS  
**ì£¼ìš” ì‘ì—…**: 12 commits

---

## ì™œ Legend Stateì¸ê°€

ê¸°ì¡´ í”„ë¡œì íŠ¸ëŠ” Zustandë¥¼ ì“°ê³  ìˆì—ˆë‹¤. ì˜ ë™ì‘í–ˆì§€ë§Œ ëª‡ ê°€ì§€ ë¶ˆí¸í•¨ì´ ìˆì—ˆë‹¤:

- ìƒíƒœ ë³€ê²½ ì‹œ ìˆ˜ë™ìœ¼ë¡œ ë¶ˆë³€ì„± ê´€ë¦¬
- ê¹Šì€ ê°ì²´ ì—…ë°ì´íŠ¸ê°€ ë²ˆê±°ë¡œì›€
- íŒŒìƒ ìƒíƒœ(computed) ì²˜ë¦¬ê°€ ì• ë§¤í•¨

Legend StateëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤:

```typescript
// Zustand - ë¶ˆë³€ì„± ì§ì ‘ ê´€ë¦¬
set((state) => ({
  user: {
    ...state.user,
    profile: {
      ...state.user.profile,
      name: newName
    }
  }
}));

// Legend State - ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥
state.user.profile.name.set(newName);
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘

```bash
63ed205 2025-09-05 feat: Legend Stateë¡œ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜
```

ê¸°ë³¸ì ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ê°„ë‹¨í–ˆë‹¤.

```typescript
// store.ts
import { observable } from '@legendapp/state';

export const appState$ = observable({
  user: null,
  theme: 'light',
  settings: {
    notifications: true,
    language: 'ko'
  }
});
```

ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©:

```typescript
import { observer } from '@legendapp/state/react';

const Profile = observer(function Profile() {
  const user = appState$.user.get();
  
  return <div>{user?.name}</div>;
});
```

---

![](./01-hydration-mismatch.jpg)

## Hydration ì§€ì˜¥ì˜ ì‹œì‘

```bash
651dd54 2025-09-08 fix: React hydration mismatch ì˜¤ë¥˜ í•´ê²°
```

ë°°í¬í•˜ê³  ë‚˜ë‹ˆ ì½˜ì†”ì— ë¹¨ê°„ ì—ëŸ¬ê°€ ë„ë°°ëë‹¤.

```
Warning: Text content did not match. 
Server: "light" Client: "dark"
```

Reactì˜ hydration mismatch ì—ëŸ¬. ì„œë²„ì—ì„œ ë Œë”ë§í•œ HTMLê³¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë Œë”ë§í•œ ê²°ê³¼ê°€ ë‹¤ë¥´ë‹¤ëŠ” ëœ»ì´ë‹¤.

### ì›ì¸

ë¬¸ì œëŠ” í…Œë§ˆ ì„¤ì •ì´ì—ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” localStorageì˜ í…Œë§ˆë¥¼ ì½ì–´ì˜¤ê³ , ì„œë²„ì—ì„œëŠ” ê¸°ë³¸ê°’ì„ ì‚¬ìš©í–ˆë‹¤.

```typescript
// ë¬¸ì œì˜ ì½”ë“œ
const theme = localStorage.getItem('theme') || 'light'; // ì„œë²„ì—ì„œ ì—ëŸ¬!
```

ì„œë²„ì—ëŠ” localStorageê°€ ì—†ë‹¤.

---

## í•´ê²° ê³¼ì •

### 1ì°¨ ì‹œë„: useEffectë¡œ í´ë¼ì´ì–¸íŠ¸ ì „ìš© ì²˜ë¦¬

```typescript
const [theme, setTheme] = useState('light'); // ì„œë²„ ê¸°ë³¸ê°’

useEffect(() => {
  const saved = localStorage.getItem('theme');
  if (saved) setTheme(saved);
}, []);
```

ì´ë ‡ê²Œ í•˜ë©´ ì—ëŸ¬ëŠ” ì‚¬ë¼ì§€ì§€ë§Œ, **ê¹œë¹¡ì„**ì´ ìƒê¸´ë‹¤. ì„œë²„ì—ì„œ lightë¡œ ë Œë”ë§í–ˆë‹¤ê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ darkë¡œ ë°”ë€Œë©´ì„œ í™”ë©´ì´ ë²ˆì©ì¸ë‹¤.

### 2ì°¨ ì‹œë„: Legend Stateì˜ persistObservable

Legend StateëŠ” localStorage ë™ê¸°í™”ë¥¼ ì§€ì›í•œë‹¤.

```typescript
import { persistObservable } from '@legendapp/state/persist';

const appState$ = observable({
  theme: 'light'
});

// í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ì‹¤í–‰
if (typeof window !== 'undefined') {
  persistObservable(appState$, {
    local: 'app-state'
  });
}
```

í•˜ì§€ë§Œ ì´ê²ƒë„ hydration ë¬¸ì œë¥¼ ì™„ì „íˆ í•´ê²°í•˜ì§„ ëª»í–ˆë‹¤.

### ìµœì¢… í•´ê²°: configureObservablePersistence

```typescript
import { configureObservablePersistence } from '@legendapp/state/persist';
import { ObservablePersistLocalStorage } from '@legendapp/state/persist-plugins/local-storage';

// ì•± ì´ˆê¸°í™” ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰
configureObservablePersistence({
  persistLocal: ObservablePersistLocalStorage,
  persistLocalOptions: {
    // SSR í™˜ê²½ì—ì„œëŠ” persist ë¹„í™œì„±í™”
    disabled: typeof window === 'undefined'
  }
});
```

ê·¸ë¦¬ê³  hydrationì´ ëë‚œ í›„ì—ë§Œ localStorage ê°’ì„ ì‚¬ìš©í•˜ë„ë¡:

```typescript
const ThemeProvider = observer(function ThemeProvider({ children }) {
  const [hydrated, setHydrated] = useState(false);
  
  useEffect(() => {
    setHydrated(true);
  }, []);
  
  // hydration ì „ì—ëŠ” ê¸°ë³¸ í…Œë§ˆ ì‚¬ìš©
  const theme = hydrated ? appState$.theme.get() : 'light';
  
  return (
    <div data-theme={theme}>
      {children}
    </div>
  );
});
```

---

## ì¶”ê°€ ê°œì„ 

### ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ì‹¤ì‹œê°„ ì ìš©

```bash
1e002f1 2025-09-05 fix: ì±„íŒ… í˜ì´ì§€ ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ì‹¤ì‹œê°„ ì ìš© ìˆ˜ì •
```

Legend Stateì˜ ì¢‹ì€ ì  ì¤‘ í•˜ë‚˜ëŠ” ìƒíƒœ ë³€ê²½ì´ ìë™ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ëŠ” ê²ƒ.

```typescript
// ìœˆë„ìš° í¬ê¸°ë¥¼ ìƒíƒœë¡œ ê´€ë¦¬
const layoutState$ = observable({
  isMobile: false
});

// ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ì—°ê²°
useEffect(() => {
  const handleResize = () => {
    layoutState$.isMobile.set(window.innerWidth < 768);
  };
  
  window.addEventListener('resize', handleResize);
  handleResize(); // ì´ˆê¸°ê°’
  
  return () => window.removeEventListener('resize', handleResize);
}, []);
```

ì´ë ‡ê²Œ í•˜ë©´ í™”ë©´ í¬ê¸°ê°€ ë°”ë€” ë•Œ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ë§Œ ìë™ìœ¼ë¡œ ë¦¬ë Œë”ë§ëœë‹¤.

### í…Œë§ˆ í† ê¸€ ë²„íŠ¼

```bash
628bf0d 2025-09-05 refactor: ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±° ë° í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ì¶”ê°€
```

```typescript
const ThemeToggle = observer(function ThemeToggle() {
  const theme = appState$.theme.get();
  
  const toggle = () => {
    appState$.theme.set(theme === 'light' ? 'dark' : 'light');
  };
  
  return (
    <button onClick={toggle}>
      {theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸'}
    </button>
  );
});
```

ìƒíƒœ ë³€ê²½ í•œ ì¤„ë¡œ í…Œë§ˆ ì „í™˜. ê¹”ë”í•˜ë‹¤.

---

## ë°°ìš´ ì 

### 1. SSR + í´ë¼ì´ì–¸íŠ¸ ìƒíƒœëŠ” í•­ìƒ ì¶©ëŒí•œë‹¤

ì„œë²„ì—ì„œ ë Œë”ë§í•˜ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ hydrateí•˜ëŠ” êµ¬ì¡°ì—ì„œ, í´ë¼ì´ì–¸íŠ¸ ì „ìš© ë°ì´í„°(localStorage, ë¸Œë¼ìš°ì € ì •ë³´ ë“±)ëŠ” í•­ìƒ ë¬¸ì œê°€ ëœë‹¤.

**í•´ê²° ì›ì¹™**: ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ì²« ë Œë”ë§ì€ ë™ì¼í•˜ê²Œ, ê·¸ í›„ì— í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ë°˜ì˜

### 2. Legend Stateì˜ ì¥ì 

- ì§ê´€ì ì¸ API (`.get()`, `.set()`)
- ìë™ êµ¬ë… (observerë¡œ ê°ì‹¸ë©´ ë)
- ë‚´ì¥ persist ì§€ì›
- ì¢‹ì€ TypeScript ì§€ì›

### 3. observer íŒ¨í„´ì˜ ì´í•´

```typescript
// ì´ë ‡ê²Œ í•˜ë©´ ì „ì²´ ìƒíƒœ ë³€ê²½ì— ë°˜ì‘
const Component = observer(() => {
  const state = appState$.get();  // ì „ì²´ ê°ì²´
  return <div>{state.user.name}</div>;
});

// ì´ë ‡ê²Œ í•˜ë©´ name ë³€ê²½ì—ë§Œ ë°˜ì‘
const Component = observer(() => {
  const name = appState$.user.name.get();  // íŠ¹ì • ê°’ë§Œ
  return <div>{name}</div>;
});
```

í•„ìš”í•œ ìƒíƒœë§Œ êµ¬ë…í•˜ë©´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

---

## ë§ˆë¬´ë¦¬

```bash
2681ed0 2025-09-09 íŒŒë¹„ì½˜ ì—…ë°ì´íŠ¸
b3a1dbd 2025-09-09 í—¤ë”ì™€ í† ìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸ ì œê±°
```

1ì£¼ì¼ê°„ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ëì— Legend State ê¸°ë°˜ ì•±ì´ ì™„ì„±ëë‹¤.

Hydration ì—ëŸ¬ ë•Œë¬¸ì— ì´í‹€ì„ ë‚ ë ¸ì§€ë§Œ, ë•ë¶„ì— React SSRì˜ ë™ì‘ ë°©ì‹ì„ ê¹Šì´ ì´í•´í•˜ê²Œ ëë‹¤. Legend State ìì²´ëŠ” ë§Œì¡±ìŠ¤ëŸ½ë‹¤. íŠ¹íˆ ê¹Šì€ ê°ì²´ ì—…ë°ì´íŠ¸ê°€ í¸í•´ì§„ ê²Œ ì²´ê°ëœë‹¤.

---

*ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë§ì§€ë§Œ, ê²°êµ­ ì¤‘ìš”í•œ ê±´ SSRê³¼ì˜ í˜¸í™˜ì„±ì´ë‹¤.*
